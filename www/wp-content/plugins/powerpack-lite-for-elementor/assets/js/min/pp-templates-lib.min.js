!function(a,o){var e=Backbone.Model.extend({defaults:{template_id:0,title:"",source:"",type:"",subtype:"",author:"",thumbnail:"",url:"",export_link:"",tags:[]}}),i=Backbone.Collection.extend({model:e}),t=Marionette.Behavior.extend({ui:{insertButton:".elementor-template-library-template-insert"},events:{"click @ui.insertButton":"onInsertButtonClick"},onInsertButtonClick:function(){var e={model:this.view.model};$e.run("powerpack/insert-template",e)}}),r=Marionette.ItemView.extend({className:function(){var e="elementor-template-library-template",t=this.model.get("source");return e+=" elementor-template-library-template-remote",e+=" elementor-template-library-template-"+t,"powerpack"===t&&(e+=" elementor-template-library-template-"+this.model.get("type")),this.model.get("isPro")&&(e+=" elementor-template-library-pro-template"),e},ui:function(){return{previewButton:".elementor-template-library-template-preview"}},events:function(){return{"click @ui.previewButton":"onPreviewButtonClick"}},behaviors:{insertTemplate:{behaviorClass:t}}}),n=r.extend({template:"#tmpl-elementor-template-library-template-pp",ui:function(){return jQuery.extend(r.prototype.ui.apply(this,arguments),{favoriteCheckbox:".elementor-template-library-template-favorite-input"})},events:function(){return jQuery.extend(r.prototype.events.apply(this,arguments),{"change @ui.favoriteCheckbox":"onFavoriteCheckboxChange"})},onPreviewButtonClick:function(){$e.route("powerpack/preview",{model:this.model})},onFavoriteCheckboxChange:function(){var e=this.ui.favoriteCheckbox[0].checked;this.model.set("favorite",e),pp_templates_lib.templates.markAsFavorite(this.model,e),!e&&pp_templates_lib.templates.getFilter("favorite")&&a.channels.templates.trigger("filter:change")}}),l=Marionette.ItemView.extend({template:"#tmpl-elementor-template-library-preview",id:"elementor-template-library-preview",ui:{iframe:"> iframe"},onRender:function(){this.ui.iframe.attr("src",this.getOption("url"))}}),s=Marionette.ItemView.extend({template:"#tmpl-elementor-template-library-header-preview-pp",id:"elementor-template-library-header-preview",behaviors:{insertTemplate:{behaviorClass:t}}}),p=Marionette.ItemView.extend({template:"#tmpl-elementor-template-library-header-back",id:"elementor-template-library-header-preview-back",events:{click:"onClick"},onClick:function(){$e.routes.restoreState("powerpack")}}),m=Marionette.CompositeView.extend({template:"#tmpl-elementor-template-library-templates-pp",id:"elementor-template-library-templates",childViewContainer:"#elementor-template-library-templates-container",reorderOnSort:!0,ui:{textFilter:"#elementor-template-library-filter-text",selectFilter:".elementor-template-library-filter-select",myFavoritesFilter:"#elementor-template-library-filter-my-favorites",orderInputs:".elementor-template-library-order-input",orderLabels:"label.elementor-template-library-order-label"},events:{"input @ui.textFilter":"onTextFilterInput","change @ui.selectFilter":"onSelectFilterChange","change @ui.myFavoritesFilter":"onMyFavoritesFilterChange","mousedown @ui.orderLabels":"onOrderLabelsClick"},comparators:{title:function(e){return e.get("title").toLowerCase()}},getChildView:function(e){return n},initialize:function(){this.listenTo(a.channels.templates,"filter:change",this._renderChildren)},filter:function(n){var e=pp_templates_lib.templates.getFilterTerms(),a=!0;return jQuery.each(e,function(e){var t=pp_templates_lib.templates.getFilter(e);if(t){if(this.callback){var r=this.callback.call(n,t);return r||(a=!1),r}var o=t===n.get(e);return o||(a=!1),o}}),a},order:function(e,t){var r=this.comparators[e]||e;t&&(r=this.reverseOrder(r)),this.collection.comparator=r,this.collection.sort()},reverseOrder:function(n){var t;return"function"!=typeof n&&(t=n,n=function n(e){return e.get(t)}),function(e,t){var r=n(e),o=n(t);return undefined===r?-1:undefined===o||r<o?1:o<r?-1:0}},addSourceData:function(){var e=this.children.isEmpty();this.$el.attr("data-template-source",e?"empty":pp_templates_lib.templates.getFilter("source"))},setFiltersUI:function(){this.$(this.ui.selectFilter).select2({placeholder:a.translate("category"),allowClear:!0,width:150,dropdownParent:this.$el})},setMasonrySkin:function(){var e=new elementorModules.utils.Masonry({container:this.$childViewContainer,items:this.$childViewContainer.children()});this.$childViewContainer.imagesLoaded(e.run.bind(e))},toggleFilterClass:function(){this.$el.toggleClass("elementor-templates-filter-active",!(!pp_templates_lib.templates.getFilter("text")&&!pp_templates_lib.templates.getFilter("favorite")))},onRender:function(){"powerpack"===pp_templates_lib.templates.getFilter("source")&&this.setFiltersUI()},onRenderCollection:function(){this.addSourceData(),this.toggleFilterClass(),"powerpack"===pp_templates_lib.templates.getFilter("source")&&"page"!==pp_templates_lib.templates.getFilter("type")&&this.setMasonrySkin()},onBeforeRenderEmpty:function(){this.addSourceData()},onTextFilterInput:function(){pp_templates_lib.templates.setFilter("text",this.ui.textFilter.val())},onSelectFilterChange:function(e){var t=jQuery(e.currentTarget),r=t.data("elementor-filter");pp_templates_lib.templates.setFilter(r,t.val())},onMyFavoritesFilterChange:function(){pp_templates_lib.templates.setFilter("favorite",this.ui.myFavoritesFilter[0].checked)},onOrderLabelsClick:function(e){var t,r=jQuery(e.currentTarget.control);r[0].checked||(t="asc"!==r.data("default-ordering-direction")),r.toggleClass("elementor-template-library-order-reverse",t),this.order(r.val(),r.hasClass("elementor-template-library-order-reverse"))}}),c=Marionette.ItemView.extend({template:"#tmpl-elementor-templates-modal__header__logo_pp",className:function(){return"elementor-templates-modal__header__logo"},events:function(){return{click:"onClick"}},templateHelpers:function(){return{title:this.getOption("title")}},onClick:function(){var e=this.getOption("click");e&&e()}}),u=Marionette.ItemView.extend({template:"#tmpl-elementor-template-library-header-actions-pp",id:"elementor-template-library-header-actions",ui:{sync:"#elementor-template-library-header-sync i"},events:{"click @ui.sync":"onSyncClick"},onSyncClick:function(){var e=this;e.ui.sync.addClass("eicon-animation-spin"),pp_templates_lib.templates.requestLibraryData({onUpdate:function(){e.ui.sync.removeClass("eicon-animation-spin"),$e.routes.refreshContainer("powerpack")},forceUpdate:!0,forceSync:!0})}}),d=Marionette.ItemView.extend({template:"#tmpl-elementor-template-library-header-menu",id:"elementor-template-library-header-menu",templateHelpers:function(){return{tabs:$e.components.get("powerpack").getTabs()}}}),h=elementorModules.common.views.modal.Layout.extend({getModalOptions:function(){return{id:"elementor-template-library-modal",effects:{show:"show",hide:"hide"}}},getLogoOptions:function(){return{title:"PowerPack Templates",click:function(){return $e.run("powerpack/open",{toDefault:!0}),!1}}},getTemplateActionButton:function(e){var t="#tmpl-elementor-template-library-insert-button";e.isPro&&"inactive"===e.proStatus&&(t="#tmpl-elementor-template-library-get-pro-button-pp"),e.isPro&&"license_inactive"===e.proStatus&&(t="#tmpl-elementor-pro-template-library-activate-license-button-pp");var r=Marionette.TemplateCache.get(t);return Marionette.Renderer.render(r)},setHeaderDefaultParts:function(){var e=this.getHeaderView();e.tools.show(new u),e.menuArea.show(new d),this.showLogo()},showLogo:function(){this.getHeaderView().logoArea.show(new c(this.getLogoOptions()))},showTemplatesView:function(e){this.modalContent.show(new m({collection:e}))},showPreviewView:function(e){this.modalContent.show(new l({url:e.get("url")}));var t=this.getHeaderView();t.menuArea.reset(),t.tools.show(new s({model:e})),t.logoArea.show(new p)}}),g=function(e){function t(){return Object.getPrototypeOf(t).apply(this,arguments)}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.setPrototypeOf(t,e);var r=Object.getPrototypeOf(t.prototype);return t.prototype.__construct=function(e){r.__construct.call(this,e),a.on("document:loaded",this.onDocumentLoaded.bind(this))},t.prototype.getNamespace=function(){return"powerpack"},t.prototype.defaultTabs=function(){return{"templates/blocks":{title:"Blocks",getFilter:function(){return{source:"powerpack",type:"block",subtype:a.config.document.remoteLibrary.category}}},"templates/pages":{title:"Pages",filter:{source:"powerpack",type:"page"}}}},t.prototype.defaultRoutes=function(){return{preview:function(e){this.manager.layout.showPreviewView(e.model)}}},t.prototype.defaultCommands=function(){return Object.assign(r.defaultCommands.call(this),{open:this.show,"insert-template":this.insertTemplate})},t.prototype.defaultShortcuts=function(){return{open:{keys:"ctrl+shift+p"}}},t.prototype.onDocumentLoaded=function(e){this.setDefaultRoute("templates/blocks"),this.maybeOpenLibrary()},t.prototype.renderTab=function(e){var t=this.tabs[e],r=t.getFilter?t.getFilter():t.filter;this.manager.setScreen(r)},t.prototype.activateTab=function(e){$e.routes.saveState("powerpack"),r.activateTab.call(this,e)},t.prototype.open=function(){return r.open.call(this),this.manager.layout||(this.manager.layout=this.layout),this.manager.layout.setHeaderDefaultParts(),!0},t.prototype.close=function(){return!!r.close.call(this)&&(this.manager.modalConfig={},!0)},t.prototype.show=function(e){!(this.manager.modalConfig=e).toDefault&&$e.routes.restoreState("powerpack")||$e.route(this.getDefaultRoute())},t.prototype.insertTemplate=function(e){var r=e.model,o=this,n=e.withPageSettings||null;null===n&&r.get("hasPageSettings")?this.getImportSettingsDialog().showImportDialog(r):(this.manager.layout.showLoadingView(),this.manager.requestTemplateContent(r.get("source"),r.get("template_id"),{data:{with_page_settings:n},success:function(e){var t=jQuery.extend({},o.manager.modalConfig.importOptions);t.withPageSettings=n,o.manager.layout.hideLoadingView(),o.manager.layout.hideModal(),$e.run("document/elements/import",{model:r,data:e,options:t})},error:function(e){o.manager.showErrorDialog(e)},complete:function(){o.manager.layout.hideLoadingView()}}),t.prototype.getImportSettingsDialog=function(){var r={dialog:null,showImportDialog:function(e){var t=r.getDialog();t.onConfirm=function(){$e.run("library/insert-template",{model:e,withPageSettings:!0})},t.onCancel=function(){$e.run("library/insert-template",{model:e,withPageSettings:!1})},t.show()},initDialog:function(){r.dialog=elementorCommon.dialogsManager.createWidget("confirm",{id:"elementor-insert-template-settings-dialog",headerMessage:a.translate("import_template_dialog_header"),message:a.translate("import_template_dialog_message")+"<br>"+a.translate("import_template_dialog_message_attention"),strings:{confirm:a.translate("yes"),cancel:a.translate("no")}})},getDialog:function(){return r.dialog||r.initDialog(),r.dialog}};return r})},t.prototype.getTabsWrapperSelector=function(){return"#elementor-template-library-header-menu"},t.prototype.getModalLayout=function(){return h},t.prototype.maybeOpenLibrary=function(){"#powerpack"===location.hash&&($e.run("powerpack/open"),location.hash="")},t}(elementorModules.common.ComponentModal),f=function f(){var e,r=this,o={},t={},n=!1;this.modalConfig={};this.getFilter=function(e){return a.channels.templates.request("filter:"+e)},this.setFilter=function(e,t,r){a.channels.templates.reply("filter:"+e,t),r||a.channels.templates.trigger("filter:change")},this.setScreen=function(e){a.channels.templates.stopReplying(),r.setFilter("source",e.source,!0),r.setFilter("type",e.type,!0),r.setFilter("subtype",e.subtype,!0),r.showTemplates()},this.getTemplatesCollection=function(){return n},this.getConfig=function(e){return e?o[e]?o[e]:{}:o},this.getFilterTerms=function(e){return e?t[e]:t},this.requestLibraryData=function(t){var e;!n||t.forceUpdate?(t.onBeforeUpdate&&t.onBeforeUpdate(),e={data:{},success:function(e){n=new i(e.templates),e.config&&(o=e.config),t.onUpdate&&t.onUpdate()}},t.forceSync&&(e.data.sync=!0),elementorCommon.ajax.addRequest("pp_get_library_data",e)):t.onUpdate&&t.onUpdate()},this.loadTemplates=function(e){r.requestLibraryData({onBeforeUpdate:r.layout.showLoadingView.bind(r.layout),onUpdate:function(){r.layout.hideLoadingView(),e&&e()}})},this.showTemplates=function(){r.layout.setHeaderDefaultParts(),r.layout.showModal(),r.loadTemplates(function(){var e=r.filterTemplates();r.layout.showTemplatesView(new i(e))})},this.filterTemplates=function(){return n.filter(function(e){return"powerpack"===e.get("source")&&("block"===e.get("type")||"page"===e.get("type"))})},this.requestTemplateContent=function(e,t,r){var o={unique_id:t,data:{source:e,edit_mode:!0,display:!0,template_id:t}};return r&&jQuery.extend(!0,o,r),elementorCommon.ajax.addRequest("get_template_data",o)},this.markAsFavorite=function(e,t){var r={data:{source:e.get("source"),template_id:e.get("template_id"),favorite:t}};return elementorCommon.ajax.addRequest("mark_template_as_favorite",r)},this.getErrorDialog=function(){return e=e||elementorCommon.dialogsManager.createWidget("alert",{id:"elementor-template-library-error-dialog",headerMessage:a.translate("an_error_occurred")})},this.showErrorDialog=function(e){var t;"object"==typeof e?(t="",_.each(e,function(e){t+="<div>"+e.message+".</div>"}),e=t):e?e+=".":e="<i>&#60;The error message is empty&#62;</i>",r.getErrorDialog().setMessage(a.translate("templates_request_error")+'<div id="elementor-template-library-error-info">'+e+"</div>").show()},this.init=function(){t={text:{callback:function(t){return t=t.toLowerCase(),0<=this.get("title").toLowerCase().indexOf(t)||_.any(this.get("tags"),function(e){return 0<=e.toLowerCase().indexOf(t)})}},type:{},subtype:{},favorite:{}},this.component=$e.components.register(new g({manager:this}))}};pp_templates_lib.templates=new f,pp_templates_lib.templates.init(),a.on("document:loaded",function(){var t=a.$previewContents,e=o("<style />");e.html(".elementor-add-section-area-button.pp-add-template-button { margin-left: 8px; vertical-align: bottom; }.elementor-add-section-area-button.pp-add-template-button img { height: 40px; }"),t.find("head").append(e);var r=o("<div />");r.addClass("elementor-add-section-area-button pp-add-template-button"),r.attr("title","Add PowerPack Template"),r.html('<img src="'+pp_templates_lib.logoUrl+'" />'),r.insertAfter(t.find(".elementor-add-section-area-button.elementor-add-template-button")),r.on("click",function(){$e.run("powerpack/open")}),t.find("body").delegate(".elementor-editor-element-add","click",function(e){setTimeout(function(){var e=t.find("body").find(".elementor-add-section-inner");0<e.length&&(e.find(".pp-add-template-button").remove(),r.off("click").on("click",function(){$e.run("powerpack/open")}),r.insertAfter(e.find(".elementor-add-section-area-button.elementor-add-template-button")))},100)})})}(elementor,jQuery,window);