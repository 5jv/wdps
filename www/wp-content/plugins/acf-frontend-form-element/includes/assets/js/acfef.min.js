var modalLevel=1,narrowfy=0,relField;
(function(c){function v(a,b){a=a+"-"+modalLevel;var d=9+modalLevel,e=c("#modal_"+a);e.length?e.removeClass("hide").addClass("show"):(e=c('<div id="modal_'+a+'" class="modal edit-modal show" data-clear="1"><div class="modal-content" style="margin:'+d+"% auto;width:"+b+'px;max-width:80%"><div class="modal-inner"><span class="acf-icon -cancel close"></span><div class="content-container"><div class="loading"><span class="acf-loading"></span></div></div></div></div></div>'),c("body").append(e));return e}
function w(a,b){var d={action:"acfef/fields/relationship/add_form",field_key:a.data("key"),parent_form:a.parents("form").attr("id"),form_action:b};c.ajax({url:acf.get("ajaxurl"),data:acf.prepareForAjax(d),type:"post",dataType:"html",success:y})}function y(a){container.find(".content-container").html(a);acf.do_action("append",container)}c("body").on("input","input.image-preview",function(a){var b=new FileReader,d=c(this);b.onload=function(){d.parents(".hide-if-value").addClass("acfef-hidden").siblings(".show-if-value").addClass("show").find("img").attr("src",
b.result)};imagePreview=!0;b.readAsDataURL(a.target.files[0])});c("body").on("click","a[data-name=remove]",function(a){c(this).parents(".show-if-value").removeClass("show").siblings(".hide-if-value").removeClass("acfef-hidden").find("input.image-preview").val("")});c(document).on("elementor/popup/show",function(a,b,d){acf.do_action("append",c("#elementor-popup-modal-"+b))});c("body").on("change",".posts-select",function(a){a=c(this);var b=a.parents(".acfef-form-posts").siblings("form");a.parents(".acfef-form-posts").append('<span class="acf-loading"></span>');
var d=b.data("widget");a=b.find("input[name=_acf_form]").val();a={action:"acfef/forms/change_form",draft:c(this).val(),form_data:a};c.ajax({url:acf.get("ajaxurl"),data:acf.prepareForAjax(a),type:"post",dataType:"json",cache:!1,success:function(e){e.data.reload_form&&(c("body, html").animate({scrollTop:b.offset().top},"slow"),b.siblings(".acfef-form-posts").remove(),b.replaceWith(e.data.reload_form),acf.do_action("append",c(".elementor-element-"+d)),c(".acf-loading").remove())}})});c("body").on("click",
"span.close-msg",function(a){c(this).parents(".acfef-message").remove()});c("body").on("input click",".acf-fields,.acf-form-submit",function(a){c(".acfef-message").remove()});c("body").on("click","a.add-rel-post",function(){relField=$el=c(this).parents(".acf-field-relationship");container=v($el.data("key"),$el.data("form_width")-narrowfy);modalLevel++;narrowfy+=20;w($el,"add_post")});c("body").on("click","a.edit-rel-post",function(a){c(a.target).is("a.edit-rel-post")&&(a.stopPropagation(),relField=
$el=c(this).parents(".acf-field-relationship"),container=v($el.data("key"),$el.data("form_width")-narrowfy),a=c(this).parent("span.acf-rel-item").data("id"),modalLevel++,narrowfy+=20,w($el,a))});c(".post-slug-field input").on("input keyup",function(){var a=this.selectionStart,b=c(this).val();c(this).val(b.replace(/[`~!@#$%^&*()|+=?;:..\u2019\u201c'"<>,\u20ac\u00a3\u00a5\u2022\u060c\u066b\u061f\u00bb\u00ab\s\{\}\[\]\\\/]+/gi,"").toLowerCase());this.setSelectionRange(a,a)});c("body").on("click","button.edit-password",
function(){c(this).addClass("acfef-hidden").siblings(".pass-strength-result").removeClass("acfef-hidden").parents(".acf-field-password").removeClass("edit_password").addClass("editing_password").next(".acf-field-password").removeClass("edit_password");c(this).after('<input type="hidden" name="edit_user_password" value="1"/>')});c("body").on("click","button.cancel-edit",function(){c(this).siblings("button.edit-password").removeClass("acfef-hidden").siblings(".pass-strength-result").addClass("acfef-hidden").parents(".acf-field-password").addClass("edit_password").removeClass("editing_password").next(".acf-field-password").addClass("edit_password");
c(this).parents("acf-input-wrap").siblings("acf-notice");c(this).siblings("input[name=edit_user_password]").remove()});c("body").on("click",".modal .close",function(a){a=c(this).parents(".modal");1==a.data("clear")&&(a.remove(),modalLevel--,narrowfy-=20)});acf.add_filter("validation_complete",function(a,b){a.errors&&(c(".acf-loading").remove(),b.find("input[type=submit]").removeClass("disabled"));return a});c("body").on("click","form.acfef-form input[type=submit]",function(a){$form=c(this).parents("form");
$form.find("input[name=_acf_status]").val(c(this).data("state"));c(this).hasClass("disabled")||c(this).after('<span class="acf-loading"></span>')});c("body").on("submit","form.acfef-form",function(a){a.preventDefault();$form=c(this);$form.find("input[type=submit]").addClass("disabled");args={form:$form,reset:!1,success:function(b){var d=c('input[type="file"]:not([disabled])',b);d.each(function(g,f){0<f.files.length||c(f).prop("disabled",!0)});var e=new FormData(b[0]);e.append("action","acfef/form_submit");
d.prop("disabled",!1);acf.lockForm(b);c.ajax({url:acf.get("ajaxurl"),type:"post",data:e,cache:!1,processData:!1,contentType:!1,success:function(g){if(g.success)if(g.data.redirect)window.location=g.data.redirect;else if(acf.unlockForm(b),successMessage='<div class="acfef-message"><div class="acf-notice -success acf-success-message"><p class="success-msg">'+g.data.update_message+'</p><span class="acfef-dismiss close-msg acf-notice-dismiss acf-icon -cancel small"></span></div></div>',g.data.append){var f=
g.data.append;g=g.data.field_key;modalLevel--;narrowfy-=20;"edit"==f.action?(c(".acf-field-relationship div.values").find("span[data-id="+f.id+"]").html(f.text+'<a href="#" class="acf-icon -minus small dark" data-name="remove_item"></a>'),c(".acf-field-relationship div.choices").find("span[data-id="+f.id+"]").html(f.text)):(1<modalLevel?(console.log(modalLevel),thisRelField=c("#modal_"+g+"-"+(modalLevel-1)).find("div[data-key="+g+"]")):thisRelField=c("div[data-key="+g+"]"),thisRelField.find("div.values ul").append('<li><input type="hidden" name="acf['+
thisRelField.data("key")+'][]" value="'+f.id+'" /><span data-id="'+f.id+'" class="acf-rel-item">'+f.text+'<a href="#" class="acf-icon -minus small dark" data-name="remove_item"></a></span></li>'));b.parents(".modal").remove()}else b.find(".acf-loading").remove(),b.find(".acfef-submit-button").attr("disabled",!1).removeClass("acf-hidden"),g.data.clear_form&&(f=b.data("widget"),b.siblings(".acfef-form-posts").remove(),b.replaceWith(g.data.clear_form),b=c(".elementor-element-"+f).find("form"),acf.do_action("append",
c(".elementor-element-"+f)),g.data.saved_message&&(b.find(".save-progress-button").after('<p class="draft-saved">'+g.data.saved_message+"</p>"),setTimeout(function(){c("body").find(".draft-saved").remove()},3E3)),g.data.update_message&&(b.prepend(successMessage),c("body, html").animate({scrollTop:c(".acfef-message").offset().top-50},"slow")))}})}};acf.validateForm(args)});var t=c("div[data-default]");c.each(t,function(a,b){var d=c(b),e=d.data("default"),g=d.data("dynamic_value"),f=d.find("input[type=text]");
if(0<e.length){var h=function(n){var l=[n,"value"];~n.indexOf(":")&&(l=n.split(":"));return l},m=function(n,l){var k=d.siblings("div[data-name="+n+"]"),p=k.find("input");"radio"==k.data("type")&&(p=1==l?k.find("input"):k.find("input:selected"));"select"==k.data("type")&&(p=k.find("select"));return p},r=function(n,l,k){var p="["+l[0]+"]";""!=k.val()&&(k=k.val(),"text"==l[1]&&(l=d.siblings("div[data-name="+l[0]+"]"),"radio"==l.data("type")&&(sourceInput=l.find(".selected").text()),"select"==l.data("type")&&
(sourceInput=l.find(":selected").text()),k=sourceInput),n=n.replace(p,k));return n},q=g;c.each(e,function(n,l){var k=h(l),p=m(k[0],!1);q=r(q,k,p);p=m(k[0],!0);p.on("input",function(){var u=g;c.each(e,function(B,z){var x=h(z),A=m(x[0],!1);u=r(u,x,A)});f.val(u)})});f.val(q)}});t=acf.Field.extend({type:"upload_images",events:{"click .acf-gallery-add":"onClickAdd","click div.acf-gallery-upload":"onClickUpload","click .acf-gallery-edit":"onClickEdit","click .acf-gallery-remove":"onClickRemove","click .acf-gallery-attachment":"onClickSelect",
"click .acf-gallery-close":"onClickClose","change .acf-gallery-sort":"onChangeSort","click .acf-gallery-update":"onUpdate",mouseover:"onHover",showField:"render","input .images-preview":"imagesPreview"},actions:{validation_begin:"onValidationBegin",validation_failure:"onValidationFailure",resize:"onResize"},onValidationBegin:function(){acf.disable(this.$sideData(),this.cid)},onValidationFailure:function(){acf.enable(this.$sideData(),this.cid)},$control:function(){return this.$(".acf-gallery")},$collection:function(){return this.$(".acf-gallery-attachments")},
$attachments:function(){return this.$(".acf-gallery-attachment:not(.not-valid)")},$clone:function(){return this.$(".image-preview-clone")},$attachment:function(a){return this.$('.acf-gallery-attachment[data-id="'+a+'"]')},$active:function(){return this.$(".acf-gallery-attachment.active")},$inValid:function(){return this.$(".acf-gallery-attachment.not-valid")},$main:function(){return this.$(".acf-gallery-main")},$side:function(){return this.$(".acf-gallery-side")},$sideData:function(){return this.$(".acf-gallery-side-data")},
isFull:function(){var a=parseInt(this.get("max")),b=this.$attachments().length;return a&&b>=a},getValue:function(){var a=[];this.$attachments().each(function(){a.push(c(this).data("id"))});return a.length?a:!1},addUnscopedEvents:function(a){this.on("change",".acf-gallery-side",function(b){a.onUpdate(b,c(this))})},addSortable:function(a){this.$collection().sortable({items:".acf-gallery-attachment",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(b,d){d.placeholder.html(d.item.html());
d.placeholder.removeAttr("style")},update:function(b,d){a.$input().trigger("change")}});this.$control().resizable({handles:"s",minHeight:200,stop:function(b,d){acf.update_user_setting("gallery_height",d.size.height)}})},initialize:function(){this.addUnscopedEvents(this);this.render()},render:function(){var a=this.$(".acf-gallery-sort"),b=this.$(".acf-gallery-add"),d=this.$attachments().length;this.isFull()?b.addClass("disabled"):b.removeClass("disabled");d?a.removeClass("disabled"):a.addClass("disabled");
this.resize()},resize:function(){var a=this.$control().width();a=Math.round(a/150);a=Math.min(a,8);this.$control().attr("data-columns",a)},onResize:function(){this.resize()},openSidebar:function(){this.$control().addClass("-open");var a=this.$control().width()/3;a=parseInt(a);a=Math.max(a,350);this.$(".acf-gallery-side-inner").css({width:a-1});this.$side().animate({width:a-1},250);this.$main().animate({right:a},250)},closeSidebar:function(){this.$control().removeClass("-open");this.$active().removeClass("active");
acf.disable(this.$side());var a=this.$(".acf-gallery-side-data");this.$main().animate({right:0},250);this.$side().animate({width:0},250,function(){a.html("")})},onClickAdd:function(a,b){this.$control().css("height","400");this.isFull()?this.showNotice({text:acf.__("Maximum selection reached"),type:"warning"}):acf.newMediaPopup({mode:"select",title:acf.__("Add Image to Gallery"),field:this.get("key"),multiple:"add",library:this.get("library"),allowedTypes:this.get("mime_types"),selected:this.val(),
select:c.proxy(function(d,e){this.appendAttachment(d,e)},this)})},imagesPreview:function(a,b){var d=this;this.$control().css("height","400");var e=this.$attachments().length,g=this.$control().data("max"),f=a.currentTarget.files;Object.keys(f).forEach(function(h){if(0<g&&e>=g)return!1;var m=f[h],r=new FileReader;r.onload=function(q){q=d.$clone().clone();q.removeClass("acf-hidden image-preview-clone").addClass("acf-gallery-attachment acf-uploading").find("img").attr("src",r.result);q.appendTo(d.$collection());
d.uploadImage(m,q)};e++;r.readAsDataURL(a.target.files[h])});e>=g&&0<g&&this.$("input.images-preview").prop("disabled",!0)},uploadImage:function(a,b){var d=b.find(".uploads-progress .percent"),e=b.find(".uploads-progress .bar");d.text("33%");e.css("width","33%");var g=this.$el.parents("form").find("input[name=_acf_nonce]").val(),f=this.get("key"),h=new FormData;h.append("action","acf/fields/upload_images/add_attachment");h.append("file",a);h.append("field_key",f);h.append("nonce",g);c.ajax({url:acf.get("ajaxurl"),
data:acf.prepareForAjax(h),type:"post",processData:!1,contentType:!1,cache:!1}).done(function(m){m.success?(d.text("100%"),e.css("width","100%"),b.attr("data-id",m.data.id).find(".acf-gallery-remove").attr("data-id",m.data.id),m=c("<input>").attr({type:"hidden",name:"acf["+f+"][]",value:m.data.id}),b.prepend(m).removeClass("acf-uploading"),setTimeout(function(){b.find(".uploads-progress").remove()},5E3)):(b.find(".uploads-progress").remove(),b.addClass("not-valid").append('<p class="errors">'+m.data+
"</p>").find(".margin").append('<p class="upload-fail">x</p>'))})},onClickUpload:function(a,b){this.isFull()?this.showNotice({text:acf.__("Maximum selection reached: "+this.$control().data("max")),type:"warning"}):this.$inValid()&&(this.$inValid().remove(),this.$("input.images-preview").prop("disabled",!1))},appendAttachment:function(a,b){a=this.validateAttachment(a);if(!this.isFull()&&!this.$attachment(a.id).length){var d=['<div class="acf-gallery-attachment" data-id="'+a.id+'">','<input type="hidden" value="'+
a.id+'" name="'+this.getInputName()+'[]">','<div class="margin" title=""><div class="thumbnail"><img src="" alt=""></div><div class="filename"></div></div><div class="actions">','<a href="#" class="acf-icon -cancel dark acf-gallery-remove" data-id="'+a.id+'"></a>',"</div></div>"].join("");d=c(d);this.$collection().append(d);if("prepend"===this.get("insert")){var e=this.$attachments().eq(b);e.length&&e.before(d)}this.renderAttachment(a);this.render();this.$input().trigger("change")}},validateAttachment:function(a){a=
acf.parseArgs(a,{id:"",url:"",alt:"",title:"",filename:"",type:"image"});if(a.attributes){a=a.attributes;var b=acf.isget(a,"sizes",this.get("preview_size"),"url");null!==b&&(a.url=b)}return a},renderAttachment:function(a){a=this.validateAttachment(a);var b=this.$attachment(a.id);if("image"==a.type)b.find(".filename").remove();else{var d=acf.isget(a,"image","src");null!==d&&(a.url=d);b.find(".filename").text(a.filename)}a.url||(a.url=acf.get("mimeTypeIcon"),b.addClass("-icon"));b.find("img").attr({src:a.url,
alt:a.alt,title:a.title});acf.val(b.find("input"),a.id)},editAttachment:function(a){acf.newMediaPopup({mode:"edit",title:acf.__("Edit Image"),button:acf.__("Update Image"),attachment:a,field:this.get("key"),select:c.proxy(function(b,d){this.renderAttachment(b)},this)})},onClickEdit:function(a,b){var d=b.data("id");d&&this.editAttachment(d)},removeAttachment:function(a){this.closeSidebar();this.$attachment(a).remove();this.render();this.$input().trigger("change")},onClickRemove:function(a,b){a.preventDefault();
a.stopPropagation();var d=b.data("id");d?this.removeAttachment(d):b.parents(".acf-gallery-attachment").remove();d=this.$attachments().length;var e=this.$control().data("max");d<e&&this.$("input.images-preview").prop("disabled",!1)},selectAttachment:function(a){var b=this.$attachment(a);if(!b.hasClass("active")){var d=this.proxy(function(){this.$side().find(":focus").trigger("blur");this.$active().removeClass("active");b.addClass("active");this.openSidebar();e()}),e=this.proxy(function(){var f={action:"acf/fields/gallery/get_attachment",
field_key:this.get("key"),id:a};this.has("xhr")&&this.get("xhr").abort();acf.showLoading(this.$sideData());f=c.ajax({url:acf.get("ajaxurl"),data:acf.prepareForAjax(f),type:"post",dataType:"html",cache:!1,success:g});this.set("xhr",f)}),g=this.proxy(function(f){if(f){var h=this.$sideData();h.html(f);h.find(".compat-field-acf-form-data").remove();h.find("> table.form-table > tbody").append(h.find("> .compat-attachment-fields > tbody > tr"));acf.doAction("append",h)}});d()}},onClickSelect:function(a,
b){var d=b.data("id");d&&this.selectAttachment(d)},onClickClose:function(a,b){this.closeSidebar()},onChangeSort:function(a,b){if(!b.hasClass("disabled")){var d=b.val();if(d){var e=[];this.$attachments().each(function(){e.push(c(this).data("id"))});var g=this.proxy(function(){var h={action:"acf/fields/gallery/get_sort_order",field_key:this.get("key"),ids:e,sort:d};c.ajax({url:acf.get("ajaxurl"),dataType:"json",type:"post",cache:!1,data:acf.prepareForAjax(h),success:f})}),f=this.proxy(function(h){acf.isAjaxSuccess(h)&&
(h.data.reverse(),h.data.map(function(m){this.$collection().prepend(this.$attachment(m))},this))});g()}}},onUpdate:function(a,b){var d=this.$(".acf-gallery-update");if(!d.hasClass("disabled")){var e=acf.serialize(this.$sideData());d.addClass("disabled");d.before('<i class="acf-loading"></i> ');e.action="acf/fields/gallery/update_attachment";c.ajax({url:acf.get("ajaxurl"),data:acf.prepareForAjax(e),type:"post",dataType:"json",complete:function(){d.removeClass("disabled");d.prev(".acf-loading").remove()}})}},
onHover:function(){this.addSortable(this);this.off("mouseover")}});acf.registerFieldType(t);acf.registerConditionForFieldType("hasValue","gallery");acf.registerConditionForFieldType("hasNoValue","gallery");acf.registerConditionForFieldType("selectionLessThan","gallery");acf.registerConditionForFieldType("selectionGreaterThan","gallery");t=acf.models.ImageField.extend({type:"upload_image"});acf.registerFieldType(t)})(jQuery);